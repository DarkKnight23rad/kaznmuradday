<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Radiology Quiz</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
  <h2>üß† –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –ø–æ –ö–¢</h2>
  <div id="timer" class="timer">15</div>
  <div id="question"></div>
  <div id="options"></div>
  <div id="result"></div>
</div>

<script>
const questions = {{ questions|tojson }};
let current = 0;
let score = 0;
let timer;
let timeLeft = 15;

// --- –ü–æ–∫–∞–∑ –≤–æ–ø—Ä–æ—Å–∞ ---
function showQuestion() {
  if (current >= questions.length) {
    localStorage.setItem("score", score);
    window.location.href = "/results";
    return;
  }

  const q = questions[current];
  document.getElementById("result").innerText = "";
  let html = `<h3>${q.question}</h3>`;

  // –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å
  if (q.image) {
    html += `<img src="/static/${q.image}" alt="image" style="max-width:400px; margin:10px;">`;
  }
  document.getElementById("question").innerHTML = html;

  // –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã
  const shuffled = q.options.sort(() => Math.random() - 0.5);
  document.getElementById("options").innerHTML = shuffled
    .map(o => `<button onclick="checkAnswer('${o}')">${o}</button>`)
    .join("");

  // –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
  timeLeft = 15;
  document.getElementById("timer").innerText = timeLeft;
  clearInterval(timer);
  timer = setInterval(() => {
    timeLeft--;
    document.getElementById("timer").innerText = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(timer);
      current++;
      showQuestion();
    }
  }, 1000);
}

// --- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ ---
function checkAnswer(ans) {
  if (ans === questions[current].answer) {
    score++;
    document.getElementById("result").innerText = "‚úÖ –í–µ—Ä–Ω–æ!";
  } else {
    document.getElementById("result").innerText = "‚ùå –ù–µ–≤–µ—Ä–Ω–æ!";
  }
  clearInterval(timer);
  setTimeout(() => { current++; showQuestion(); }, 1000);
}

showQuestion();
</script>
</body>
</html>
